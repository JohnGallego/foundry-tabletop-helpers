{{!-- Character Sheet Template --}}
{{!-- Renders a complete D&D 5e (2024) PC character sheet for printing --}}

<div class="fth-character {{paperClass}}">
  {{!-- Header --}}
  <div class="fth-header">
    {{#if hasPortrait}}
    <img class="fth-portrait" src="{{portraitUrl}}" alt="">
    {{/if}}
    <div class="fth-header-info">
      <h1>{{name}}</h1>
      <div class="fth-subtitle">{{subtitle}}</div>
      <div class="fth-header-row-widgets">
        <div class="fth-passive-scores">
          {{#each passives}}
          <div class="fth-passive-item">
            <span class="fth-passive-value">{{value}}</span>
            <span class="fth-passive-label">{{label}}</span>
          </div>
          {{/each}}
        </div>
        <div class="fth-short-rest-tracking">
          <span class="fth-rest-icon">☀</span>
          <span class="fth-track-label">Short Rests</span>
          <span class="fth-rest-checkboxes">{{{shortRestCheckboxes}}}</span>
        </div>
      </div>
      <div class="fth-senses-defenses">
        {{#if sensesLine}}
        <div class="fth-header-senses"><strong>Senses:</strong> {{sensesLine}}</div>
        {{/if}}
        {{#if hasDefenses}}
        <div class="fth-header-defenses">{{{defensesLine}}}</div>
        {{/if}}
      </div>
    </div>
    <div class="fth-hp-tracking">
      <div class="fth-track-row">
        <span class="fth-track-label">Current HP</span>
        <span class="fth-track-box"></span>
      </div>
      <div class="fth-track-row">
        <span class="fth-track-label">Temp HP</span>
        <span class="fth-track-box fth-track-box-sm"></span>
      </div>
      <div class="fth-track-row fth-death-saves">
        <span class="fth-track-label">Death Saves</span>
        <span class="fth-save-row">
          <span class="fth-save-label">✓</span>
          <span class="fth-save-circles">☐ ☐ ☐</span>
        </span>
        <span class="fth-save-row">
          <span class="fth-save-label">✗</span>
          <span class="fth-save-circles">☐ ☐ ☐</span>
        </span>
      </div>
    </div>
  </div>

  {{!-- Abilities --}}
  {{#if showAbilities}}
  <div class="fth-abilities">
    {{#each abilities}}
    <div class="fth-ability">
      <span class="fth-ability-label">{{label}}</span>
      <span class="fth-ability-mod">{{mod}}</span>
      <span class="fth-ability-score">{{score}}</span>
    </div>
    {{/each}}
  </div>
  {{/if}}

  {{!-- Combat Stats --}}
  <div class="fth-combat">
    <div class="fth-stat-box"><span class="fth-stat-label">AC</span><span class="fth-stat-value">{{combat.ac}}</span></div>
    <div class="fth-stat-box"><span class="fth-stat-label">HP</span><span class="fth-stat-value">{{combat.hpMax}}</span></div>
    <div class="fth-stat-box"><span class="fth-stat-label">Hit Dice</span><span class="fth-stat-value">{{combat.hitDice}}</span></div>
    <div class="fth-stat-box"><span class="fth-stat-label">Initiative</span><span class="fth-stat-value">{{combat.initiative}}</span></div>
    <div class="fth-stat-box"><span class="fth-stat-label">Speed</span><span class="fth-stat-value">{{combat.speed}}</span></div>
    <div class="fth-stat-box"><span class="fth-stat-label">Proficiency</span><span class="fth-stat-value">{{combat.proficiency}}</span></div>
    <div class="fth-stat-box"><span class="fth-stat-label">Inspiration</span><span class="fth-stat-value fth-checkbox">☐</span></div>
  </div>

  {{!-- Saves Widget --}}
  <div class="fth-saves-widget">
    <div class="fth-saves-title">Saving Throws</div>
    <div class="fth-saves-grid">
      <div class="fth-saves-column">
        {{#each saves.leftColumn}}
        <div class="fth-save-item">
          <span class="fth-save-prof">{{profIcon}}</span>
          <span class="fth-save-label">{{label}}</span>
          <span class="fth-save-value">{{value}}</span>
        </div>
        {{/each}}
      </div>
      <div class="fth-saves-column">
        {{#each saves.rightColumn}}
        <div class="fth-save-item">
          <span class="fth-save-prof">{{profIcon}}</span>
          <span class="fth-save-label">{{label}}</span>
          <span class="fth-save-value">{{value}}</span>
        </div>
        {{/each}}
      </div>
    </div>
    {{#if saves.saveFeatures.length}}
    <div class="fth-save-features">
      {{#each saves.saveFeatures}}
      <div class="fth-save-feature">{{{this}}}</div>
      {{/each}}
    </div>
    {{/if}}
  </div>

  {{!-- Skills --}}
  {{#if showSkills}}
  <div class="fth-skills">
    <div class="fth-section-title">Skills</div>
    <div class="fth-skills-grid">
      {{#each skills}}
      <div class="{{cssClass}}">{{profIcon}} <span class="fth-skill-mod">{{mod}}</span> {{name}} <span class="fth-skill-ability">({{ability}})</span></div>
      {{/each}}
    </div>
  </div>
  {{/if}}

  {{!-- Actions Section --}}
  {{#if showActions}}
  {{#if hasActions}}
  <div class="fth-actions">
    <div class="fth-section-title">Actions</div>
    <div class="fth-actions-content">
      {{!-- Weapons Table --}}
      {{#if actions.hasWeapons}}
      <div class="fth-action-group">
        <table class="fth-attack-table">
          <thead><tr>
            <th>Attack</th>
            <th>Range</th>
            <th>Hit</th>
            <th>Damage</th>
            <th>Notes</th>
          </tr></thead>
          <tbody>
          {{#each actions.weapons}}
          <tr>
            <td class="fth-atk-name">
              {{#if favStar}}<span class="fth-fav">{{favStar}}</span>{{/if}}<strong>{{name}}</strong>{{#if hasMastery}}<span class="fth-mastery">{{masteryBadge}}</span>{{/if}}
              <div class="fth-atk-type">{{weaponType}}</div>
            </td>
            <td class="fth-atk-range">
              <div class="fth-atk-range-val">{{range}}</div>
              {{#if rangeType}}<div class="fth-atk-range-type">{{rangeType}}</div>{{/if}}
            </td>
            <td class="fth-atk-hit"><span class="fth-hit-val">{{toHit}}</span></td>
            <td class="fth-atk-dmg">
              <span class="fth-dmg-formula">{{damage}}</span>
              {{#if damageType}}<span class="fth-dmg-type">{{damageType}}</span>{{/if}}
            </td>
            <td class="fth-atk-notes">{{properties}}</td>
          </tr>
          {{/each}}
          </tbody>
        </table>
      </div>
      {{/if}}

      {{!-- Combat Actions Reference --}}
      <div class="fth-combat-actions">
        <strong>Actions in Combat:</strong> {{actions.combatActionsRef}}
      </div>

      {{!-- Other Actions --}}
      {{#each actions.otherActions}}
      {{#if hasItems}}
      <div class="fth-action-group fth-feature-actions">
        <h3>{{title}}</h3>
        <div class="fth-action-list">
          {{#each items}}
          <div class="fth-action-item">{{{favStar}}}<strong>{{name}}.</strong>{{#if usesDisplay}} <span class="fth-action-uses">{{usesDisplay}}</span><span class="fth-action-checkboxes">{{checkboxes}}</span>{{/if}}{{#if description}} — {{description}}{{/if}}</div>
          {{/each}}
        </div>
      </div>
      {{/if}}
      {{/each}}

      {{!-- Bonus Actions --}}
      {{#each actions.bonusActions}}
      {{#if hasItems}}
      <div class="fth-action-group">
        <h3>{{title}}</h3>
        <div class="fth-action-list">
          {{#each items}}
          <div class="fth-action-item">{{{favStar}}}<strong>{{name}}.</strong>{{#if usesDisplay}} <span class="fth-action-uses">{{usesDisplay}}</span><span class="fth-action-checkboxes">{{checkboxes}}</span>{{/if}}{{#if description}} — {{description}}{{/if}}</div>
          {{/each}}
        </div>
      </div>
      {{/if}}
      {{/each}}

      {{!-- Reactions --}}
      {{#each actions.reactions}}
      {{#if hasItems}}
      <div class="fth-action-group">
        <h3>{{title}}</h3>
        <div class="fth-action-list">
          {{#each items}}
          <div class="fth-action-item">{{{favStar}}}<strong>{{name}}.</strong>{{#if usesDisplay}} <span class="fth-action-uses">{{usesDisplay}}</span><span class="fth-action-checkboxes">{{checkboxes}}</span>{{/if}}{{#if description}} — {{description}}{{/if}}</div>
          {{/each}}
        </div>
      </div>
      {{/if}}
      {{/each}}

      {{!-- Other features + Mastery Descriptions --}}
      {{#each actions.other}}
      {{#if hasItems}}
      <div class="fth-action-group">
        <h3>{{title}}</h3>
        <div class="fth-action-list">
          {{#each items}}
          <div class="fth-action-item">{{{favStar}}}<strong>{{name}}.</strong>{{#if usesDisplay}} <span class="fth-action-uses">{{usesDisplay}}</span><span class="fth-action-checkboxes">{{checkboxes}}</span>{{/if}}{{#if description}} — {{description}}{{/if}}</div>
          {{/each}}
        </div>
      </div>
      {{/if}}
      {{/each}}

      {{#if actions.hasMasteryDescriptions}}
      <div class="fth-action-group">
        <h3>Masteries</h3>
        <div class="fth-action-list">
          {{#each actions.masteryDescriptions}}
          <div class="fth-action-item"><strong>{{name}}.</strong> {{{description}}}</div>
          {{/each}}
        </div>
      </div>
      {{/if}}

    </div>
  </div>
  {{/if}}
  {{/if}}

  {{!-- Spellcasting --}}
  {{#if showSpells}}
  {{#if hasSpellcasting}}
  <div class="fth-spellcasting">
    <div class="fth-section-title">Spellcasting</div>
    <div class="fth-spell-stats">
      <div class="fth-spell-stat">
        <span class="fth-spell-stat-value">{{spellcasting.modifier}}</span>
        <span class="fth-spell-stat-label">Modifier</span>
      </div>
      <div class="fth-spell-stat">
        <span class="fth-spell-stat-value">{{spellcasting.attackMod}}</span>
        <span class="fth-spell-stat-label">Spell Attack</span>
      </div>
      <div class="fth-spell-stat">
        <span class="fth-spell-stat-value">{{spellcasting.saveDC}}</span>
        <span class="fth-spell-stat-label">Save DC</span>
      </div>
    </div>
    {{#each spellcasting.spellLevels}}
    <div class="fth-spell-level-group">
      <div class="fth-spell-level-header">
        <span class="fth-level-label">{{levelLabel}}</span>
        {{#if hasSlots}}<span class="fth-slot-display"><span class="fth-spell-slot-checkboxes">{{slotCheckboxes}}</span> SLOTS</span>{{/if}}
      </div>
      <table class="fth-spell-table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Time</th>
            <th>Range</th>
            <th>Hit/DC</th>
            <th>Effect</th>
            <th>Notes</th>
          </tr>
        </thead>
        <tbody>
          {{#each spells}}
          <tr>
            <td class="fth-spell-name">{{#if favStar}}<span class="fth-fav">{{favStar}}</span>{{/if}}{{name}} {{tags}}</td>
            <td class="fth-spell-time">{{time}}</td>
            <td class="fth-spell-range">{{range}}</td>
            <td class="fth-spell-hit">{{hitDc}}</td>
            <td class="fth-spell-effect">{{effect}}</td>
            <td class="fth-spell-notes">{{notes}}</td>
          </tr>
          {{/each}}
        </tbody>
      </table>
    </div>
    {{/each}}
  </div>
  {{/if}}
  {{/if}}

  {{!-- Features & Traits --}}
  {{#if showFeatures}}
  {{#if hasFeatures}}
  <div class="fth-features">
    <div class="fth-section-title">Features & Traits</div>
    <div class="fth-features-content">
      {{#each featureGroups}}
      <div class="fth-feat-group">
        <h3>{{category}}</h3>
        <div class="fth-feat-list">
          {{#each features}}
          <div class="fth-feat">{{{favStar}}}<span class="fth-feat-name">{{name}}</span>{{#if usesDisplay}} <span class="fth-feat-uses">{{usesDisplay}}</span><span class="fth-feat-checkboxes">{{checkboxes}}</span>{{/if}}{{#if description}} <span class="fth-feat-desc">— {{{description}}}</span>{{/if}}</div>
          {{/each}}
        </div>
      </div>
      {{/each}}
    </div>
  </div>
  {{/if}}
  {{/if}}

  {{!-- Proficiencies and Languages --}}
  {{#if hasProficiencies}}
  <div class="fth-proficiencies">
    <div class="fth-section-title">Proficiencies and Languages</div>
    <div class="fth-prof-content">
      {{#if proficiencies.hasArmor}}<div class="fth-prof-line"><strong>Armor:</strong> {{proficiencies.armor}}</div>{{/if}}
      {{#if proficiencies.hasWeapons}}<div class="fth-prof-line"><strong>Weapons:</strong> {{proficiencies.weapons}}</div>{{/if}}
      {{#if proficiencies.hasWeaponMasteries}}<div class="fth-prof-line"><strong>Weapon Mastery:</strong> {{{proficiencies.weaponMasteries}}}</div>{{/if}}
      {{#if proficiencies.hasTools}}<div class="fth-prof-line"><strong>Tools:</strong> {{proficiencies.tools}}</div>{{/if}}
      {{#if proficiencies.hasLanguages}}<div class="fth-prof-line"><strong>Languages:</strong> {{proficiencies.languages}}</div>{{/if}}
    </div>
  </div>
  {{/if}}

  {{!-- Inventory --}}
  {{#if showInventory}}
  {{#if hasInventory}}
  <div class="fth-inventory">
    <div class="fth-section-title">Inventory <span class="fth-inv-weight-total">({{inventory.totalWeight}})</span></div>

    {{!-- Currency Widget --}}
    {{#if hasCurrency}}
    <div class="fth-currency">
      <div class="fth-currency-row">
        {{#each currency.coins}}
        <div class="fth-coin {{#unless hasCoins}}fth-coin-empty{{/unless}}">
          <span class="fth-coin-icon">{{icon}}</span>
          <span class="fth-coin-val">{{amountDisplay}}</span>
          <span class="fth-coin-label">{{abbr}}</span>
        </div>
        {{/each}}
      </div>
      <div class="fth-currency-row fth-currency-input">
        {{#each currency.coins}}
        <div class="fth-coin-input">
          <span class="fth-coin-label">{{abbr}}</span>
          <span class="fth-coin-box">____</span>
        </div>
        {{/each}}
      </div>
    </div>
    {{/if}}

    <div class="fth-inv-grid">
      {{#each inventory.items}}
      {{#if isContainerGroup}}
      <div class="fth-inv-container-group">
        <div class="{{cssClass}}">
          {{eqIndicator}}{{#if hasImg}}<img class="fth-inv-icon" src="{{imgUrl}}" alt="">{{/if}}{{{favStar}}}<span class="fth-inv-item-name">{{name}}</span>{{#if usesDisplay}} <span class="fth-inv-uses">{{usesDisplay}}</span>{{/if}}{{#if meta}} <span class="fth-inv-meta">{{meta}}</span>{{/if}}
        </div>
        {{#each containerItems}}
        <div class="{{cssClass}}">
          {{eqIndicator}}{{#if hasImg}}<img class="fth-inv-icon" src="{{imgUrl}}" alt="">{{/if}}{{{favStar}}}<span class="fth-inv-item-name">{{name}}</span>{{#if usesDisplay}} <span class="fth-inv-uses">{{usesDisplay}}</span>{{/if}}{{#if meta}} <span class="fth-inv-meta">{{meta}}</span>{{/if}}
        </div>
        {{/each}}
      </div>
      {{else}}
      <div class="{{cssClass}}">
        {{eqIndicator}}{{#if hasImg}}<img class="fth-inv-icon" src="{{imgUrl}}" alt="">{{/if}}{{{favStar}}}<span class="fth-inv-item-name">{{name}}</span>{{#if usesDisplay}} <span class="fth-inv-uses">{{usesDisplay}}</span>{{/if}}{{#if meta}} <span class="fth-inv-meta">{{meta}}</span>{{/if}}
      </div>
      {{/if}}
      {{/each}}
    </div>
  </div>
  {{/if}}
  {{/if}}

  {{!-- Spell Cards on new page --}}
  {{#if showSpells}}
  {{#if hasSpellCards}}
  <div class="fth-spell-cards-page">
    <div class="fth-section-title">Spell Cards</div>
    <div class="fth-spell-cards-grid">
      {{#each spellCards}}
      <div class="fth-spell-card">
        <div class="fth-spell-card-header">
          <div class="fth-spell-card-title">
            <span class="fth-spell-card-name">{{name}} {{{concTag}}}</span>
            <span class="fth-spell-card-level">{{levelSchool}} {{{ritualTag}}}</span>
          </div>
          {{#if hasImg}}<img class="fth-spell-card-img" src="{{imgUrl}}" alt="">{{/if}}
        </div>
        <div class="fth-spell-card-stats">
          <div class="fth-spell-card-stat"><strong>Casting Time:</strong> {{castingTime}}</div>
          <div class="fth-spell-card-stat"><strong>Range:</strong> {{range}}</div>
          <div class="fth-spell-card-stat"><strong>Duration:</strong> {{duration}}</div>
          <div class="fth-spell-card-stat"><strong>Components:</strong> {{{components}}}</div>
        </div>
        {{#if hasAttackSave}}<div class="fth-spell-card-atk"><strong>Attack/Save:</strong> {{attackSave}}{{#if effect}} • <strong>Effect:</strong> {{effect}}{{/if}}</div>{{/if}}
        <div class="fth-spell-card-desc">{{description}}</div>
        {{#if hasHigherLevel}}<div class="fth-spell-higher"><strong>At Higher Levels:</strong> {{higherLevel}}</div>{{/if}}
        {{#if hasSource}}<div class="fth-spell-source">{{source}}</div>{{/if}}
      </div>
      {{/each}}
    </div>
  </div>
  {{/if}}
  {{/if}}

  {{!-- Backstory --}}
  {{#if showBackstory}}
  {{#if hasBackstory}}
  <div class="fth-backstory">
    <div class="fth-section-title">Backstory</div>
    <div class="fth-backstory-content">{{{backstory}}}</div>
  </div>
  {{/if}}
  {{/if}}

</div>

